<!DOCTYPE html>
<html lang="id" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permainan Bahasa Arab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F0F4F8;
        }
        .arabic {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 1.5rem;
            direction: rtl;
        }
        .game-card, .game-button {
            transition: all 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .draggable {
            touch-action: none;
            cursor: grab;
        }
        .drop-zone {
            transition: background-color 0.2s;
        }
        .drop-zone.over {
            background-color: #e0f2fe;
        }
        .feedback {
            transition: opacity 0.5s;
        }
        /* Memory Game Styles */
        .memory-card {
            perspective: 1000px;
        }
        .memory-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .memory-card.flipped .memory-card-inner, .memory-card.preview .memory-card-inner {
            transform: rotateY(180deg);
        }
        .memory-card-front, .memory-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            text-align: center;
            padding: 4px;
        }
        .memory-card-front {
            background-color: #60a5fa; /* blue-400 */
        }
        .memory-card-back {
            background-color: #f0f9ff; /* blue-50 */
            transform: rotateY(180deg);
        }
        
        /* (BARU) Style untuk Tic Tac Toe */
        .ttt-cell.filled { 
            cursor: not-allowed; 
        }
        .ttt-rtl { 
            direction: rtl; 
            font-family: 'Noto Naskh Arabic', serif;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-800">Permainan Bahasa Arab</h1>
            <p class="text-gray-600 mt-2">(Berdasarkan Buku Al-Arobiyyah Baina Yadai Aulaadina Hal. 11-30)</p>
        </header>

        <main>
            <!-- Menu Pilihan Game -->
            <section id="game-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6">
                <!-- Row 1 -->
                <div onclick="startGame('match-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-blue-500">
                    <h3 class="text-xl font-bold text-blue-800">1. Pasangkan Kata</h3>
                    <p class="mt-2 text-gray-600">Cocokkan kata Arab dengan artinya.</p>
                </div>
                <div onclick="startGame('find-letter-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-green-500">
                    <h3 class="text-xl font-bold text-green-800">2. Cari Huruf</h3>
                    <p class="mt-2 text-gray-600">Temukan huruf yang diminta di antara pilihan.</p>
                </div>
                <div onclick="startGame('arrange-letters-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-purple-500">
                    <h3 class="text-xl font-bold text-purple-800">3. Susun Kata</h3>
                    <p class="mt-2 text-gray-600">Susun komponen acak menjadi kata bersambung.</p>
                </div>
                <!-- Row 2 -->
                <div onclick="startGame('true-false-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-red-500">
                    <h3 class="text-xl font-bold text-red-800">4. Benar atau Salah</h3>
                    <p class="mt-2 text-gray-600">Tentukan apakah arti kata yang ditampilkan benar.</p>
                </div>
                <div onclick="startGame('guess-word-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-yellow-500">
                    <h3 class="text-xl font-bold text-yellow-800">5. Tebak Kata</h3>
                    <p class="mt-2 text-gray-600">Lengkapi kalimat percakapan yang rumpang.</p>
                </div>
                <div onclick="startGame('memory-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-indigo-500">
                    <h3 class="text-xl font-bold text-indigo-800">6. Memori Huruf</h3>
                    <p class="mt-2 text-gray-600">Cari pasangan huruf yang sama setelah menghafal.</p>
                </div>
                <!-- Row 3 -->
                <div onclick="startGame('greeting-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-cyan-500">
                    <h3 class="text-xl font-bold text-cyan-800">7. Pilih Sapaan Tepat</h3>
                    <p class="mt-2 text-gray-600">Pilih sapaan yang sesuai dengan situasi.</p>
                </div>
                <div onclick="startGame('logical-pairs-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-orange-500">
                    <h3 class="text-xl font-bold text-orange-800">8. Sambungkan Kalimat</h3>
                    <p class="mt-2 text-gray-600">Hubungkan pertanyaan dengan jawaban yang logis.</p>
                </div>
                <div onclick="startGame('memory-word-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-pink-500">
                    <h3 class="text-xl font-bold text-pink-800">9. Memori Kata</h3>
                    <p class="mt-2 text-gray-600">Cocokkan kata dan artinya setelah menghafal.</p>
                </div>
                <!-- (BARU) Row 4 -->
                 <div onclick="startGame('tic-tac-toe-game')" class="game-card bg-white p-6 rounded-xl shadow-md cursor-pointer border-l-8 border-teal-500">
                    <h3 class="text-xl font-bold text-teal-800">10. Tic Tac Toe Kosa Kata</h3>
                    <p class="mt-2 text-gray-600">Jawab soal kosa kata untuk menempatkan tandamu.</p>
                </div>
            </section>
            
            <!-- Container untuk Game yang aktif -->
            <section id="game-container" class="mt-8 hidden"></section>
        </main>
    </div>

    <!-- (BARU) Modal untuk Tic Tac Toe (di luar container utama) -->
    <div id="ttt-question-modal" class="fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 backdrop-blur-sm z-50" style="display: none;">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full" id="ttt-question-box">
            <h2 class="text-xl font-semibold text-center text-gray-700 mb-2">Apa arti dari kata ini?</h2>
            <h3 id="ttt-vocab-word" class="text-5xl font-bold text-center text-gray-900 my-6 ttt-rtl">
                <!-- Kata TTT diisi JS -->
            </h3>
            <div id="ttt-options-container" class="flex flex-col space-y-3">
                <!-- Pilihan TTT diisi JS -->
            </div>
            <div id="ttt-timer-display" class="text-2xl font-bold text-center text-red-500 my-4 h-8">
                <!-- Timer TTT diisi JS -->
            </div>
            <p id="ttt-result-message" class="text-center font-semibold mt-4 h-6">
                <!-- Pesan TTT diisi JS -->
            </p>
        </div>
    </div>


    <script>
        // --- DATA UNTUK GAMES ---
        const matchData = { "Nama saya": "اسْمِي", "Nama kamu (pr)": "اسْمُكِ", "Saya": "أَنَا", "Kamu (lk)": "أَنْتَ", "Selamat tinggal": "مَعَ السَّلَامَةِ", "Apa kabarmu? (lk)": "كَيْفَ حَالُكَ؟" };
        const findLetterPool = ['ت', 'ط', 'خ', 'ك', 'د', 'ذ', 'ر', 'ز', 'س', 'ش', 'ص', 'ض', 'أ', 'ب', 'ث'];
        const arrangeWordData = [
            { word: "خَدِيجَةُ", components: ["خَ", "دِي", "جَ", "ةُ"] },
            { word: "السَّلَامُ", components: ["ال", "سَّ", "لَا", "مُ"] },
            { word: "عَلَيْكُمْ", components: ["عَ", "لَيْ", "كُمْ"] }
        ];
        const trueFalseData = [
            { word: "مَا اسْمُكِ؟", meaning: "Siapa namamu (lk)?", correct: false },
            { word: "أَنَا بِخَيْرٍ", meaning: "Saya baik-baik saja", correct: true },
            { word: "أَنْتِ", meaning: "Kamu (pr)", correct: true },
            { word: "السَّلَامُ", meaning: "Sampai Jumpa", correct: false }
        ];
        const guessWordData = [
            { sentence: ["السَّلَامُ", "______"], options: ["عَلَيْكُمْ", "بِخَيْرٍ", "اسْمُكِ"], answer: "عَلَيْكُمْ" },
            { sentence: ["مَا", "______؟"], options: ["أَنَا", "اسْمُكَ", "خَوْلَةُ"], answer: "اسْمُكَ" },
            { sentence: ["أَنَا", "______"], options: ["حَالُكَ", "بِخَيْرٍ", "مَعَ"], answer: "بِخَيْرٍ" }
        ];
        const memoryGameLetters = ['أ', 'ب', 'ت', 'ث', 'ج', 'ح'];
        const memoryWordData = [ 
            { arabic: 'اسْمِي', indo: 'Nama saya' }, 
            { arabic: 'أَنَا', indo: 'Saya' }, 
            { arabic: 'أَنْتَ', indo: 'Kamu (lk)' }, 
            { arabic: 'بِخَيْرٍ', indo: 'Baik-baik' },
            { arabic: 'اسْمُكِ', indo: 'Namamu (pr)' },
            { arabic: 'أَنْتِ', indo: 'Kamu (pr)' },
            { arabic: 'السَّلَامُ', indo: 'Keselamatan' },
            { arabic: 'عَلَيْكُمْ', indo: 'Atas kalian' }
        ];
        const greetingGameData = [
            { situation: "Saat dua orang bertemu untuk pertama kali:", options: ["السَّلَامُ عَلَيْكُمْ", "مَعَ السَّلَامَةِ", "أَنَا بِخَيْرٍ"], answer: "السَّلَامُ عَلَيْكُمْ" },
            { situation: "Saat seseorang menjawab sapaan salam:", options: ["كَيْفَ حَالُكَ؟", "وَعَلَيْكُمُ السَّلَامُ", "اسْمِي"], answer: "وَعَلَيْكُمُ السَّلَامُ" },
        ];
        const logicalPairsData = { "السَّلَامُ عَلَيْكُمْ": "وَعَلَيْكُمُ السَّلَامُ", "مَا اسْمُكِ؟": "اسْمِي خَدِيجَةُ", "كَيْفَ حَالُكَ؟": "أَنَا بِخَيْرٍ" };

        // (BARU) Data untuk Tic Tac Toe
        const ticTacToeData = [
            { word: "أَنَا", options: ["Saya", "Kamu (lk)", "Dia (pr)"], correct: 0 },
            { word: "قَلَمُ", options: ["Mobil", "Pena", "Tas"], correct: 1 },
            { word: "اسْمِي", options: ["Namamu (pr)", "Nama saya", "Namamu (lk)"], correct: 1 },
            { word: "نَعَمْ", options: ["Ya", "Tidak", "Di mana"], correct: 0 },
            { word: "لَا", options: ["Berapa", "Ya", "Tidak"], correct: 2 },
            { word: "أَيْنَ", options: ["Di sini", "Di mana", "Banyak"], correct: 1 },
            { word: "هُنَا", options: ["Di sini", "Di sana", "Pena"], correct: 0 },
            { word: "وَاحِدٌ", options: ["Tiga", "Satu", "Dua"], correct: 1 },
            { word: "اثْنَانِ", options: ["Dua", "Empat", "Satu"], correct: 0 },
            { word: "ثَلَاثَةٌ", options: ["Lima", "Tiga", "Empat"], correct: 1 },
            { word: "حَقِيبَةٌ", options: ["Kertas", "Mobil", "Tas"], correct: 2 },
            { word: "سَيَّارَةٌ", options: ["Mobil", "Tas", "Sedikit"], correct: 0 },
            { word: "كَثِيرٌ", options: ["Sedikit", "Berapa", "Banyak"], correct: 2 },
            { word: "قَلِيلٌ", options: ["Sedikit", "Banyak", "Mobil"], correct: 0 },
            { word: "كَمْ", options: ["Di mana", "Berapa", "Tidak"], correct: 1 },
            { word: "وَرَقَةٌ", options: ["Kertas", "Pena", "Satu"], correct: 0 },
            { word: "أَنْتَ", options: ["Saya", "Kamu (lk)", "Kamu (pr)"], correct: 1 },
            { word: "أَنْتِ", options: ["Kamu (pr)", "Dia (lk)", "Saya"], correct: 0 },
            { word: "اسْمُكَ", options: ["Namamu (lk)", "Nama saya", "Namamu (pr)"], correct: 0 },
            { word: "اسْمُكِ", options: ["Nama saya", "Namamu (lk)", "Namamu (pr)"], correct: 2 }
        ];

        // --- FUNGSI UTAMA ---
        function startGame(gameId) {
            document.getElementById('game-menu').classList.add('hidden');
            const container = document.getElementById('game-container');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div id="game-content"></div>
                    <button onclick="showMenu()" class="mt-6 bg-gray-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors"> Kembali ke Menu</button>
                </div>`;
            
            const gameContent = document.getElementById('game-content');
            
            const gameFunctions = {
                'match-game': setupMatchGame,
                'find-letter-game': setupFindLetterGame,
                'arrange-letters-game': setupArrangeLettersGame,
                'true-false-game': setupTrueFalseGame,
                'guess-word-game': setupGuessWordGame,
                'memory-game': setupMemoryGame,
                'greeting-game': setupGreetingGame,
                'logical-pairs-game': setupLogicalPairsGame,
                'memory-word-game': setupMemoryWordGame,
                'tic-tac-toe-game': setupTicTacToeGame // (BARU)
            };
            if (gameFunctions[gameId]) {
                gameFunctions[gameId](gameContent);
            }
        }

        // (BARU) Objek untuk menampung logika & status Tic Tac Toe
        // Kita letakkan di luar agar bisa diakses oleh showMenu() untuk clear timer
        let tttGameLogic = {
            player: 'X',
            board: Array(9).fill(''),
            active: true,
            targetIndex: null,
            questions: [],
            timer: null,
            // Variabel DOM (akan di-cache saat init)
            dom: {}
        };

        function showMenu() {
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('game-menu').classList.remove('hidden');

            // (BARU) Cleanup untuk Tic Tac Toe
            const tttModal = document.getElementById('ttt-question-modal');
            if (tttModal) tttModal.style.display = 'none';
            if (tttGameLogic.timer) clearInterval(tttGameLogic.timer);
            // Reset TTT logic state
            tttGameLogic = { ...tttGameLogic, active: false, timer: null, dom: {} };
        }
        
        // --- GAME 1, 2, 4, 5 (Tidak Berubah) ---
        function setupMatchGame(container) { 
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-blue-800 mb-4">Pasangkan Kata!</h3>
                <div class="flex flex-col md:flex-row justify-between items-start gap-4">
                    <div id="indonesian-words" class="w-full md:w-1/2 flex flex-col gap-3"></div>
                    <div id="arabic-words" class="w-full md:w-1/2 flex flex-col gap-3"></div>
                </div>
                <p id="feedback" class="feedback text-center font-bold mt-4 h-6"></p>`;
            
            let selectedIndo = null, selectedArabic = null, matchedPairs = 0;
            const feedbackEl = container.querySelector('#feedback');
            const indoContainer = container.querySelector('#indonesian-words');
            const arabicContainer = container.querySelector('#arabic-words');

            const indoWords = Object.keys(matchData);
            const arabicWords = Object.values(matchData).sort(() => Math.random() - 0.5);

            indoWords.forEach(word => {
                const btn = document.createElement('button');
                btn.innerText = word;
                btn.dataset.word = word;
                btn.className = 'game-button w-full p-3 bg-blue-100 rounded-lg text-blue-800 font-semibold border-2 border-transparent';
                btn.onclick = () => {
                    if (selectedIndo) selectedIndo.classList.remove('ring-4', 'ring-blue-400');
                    selectedIndo = btn;
                    selectedIndo.classList.add('ring-4', 'ring-blue-400');
                    checkMatch();
                };
                indoContainer.appendChild(btn);
            });

            arabicWords.forEach(word => {
                const btn = document.createElement('button');
                btn.innerText = word;
                btn.dataset.word = word;
                btn.className = 'game-button w-full p-3 bg-green-100 rounded-lg text-green-800 font-semibold arabic border-2 border-transparent';
                btn.onclick = () => {
                    if (selectedArabic) selectedArabic.classList.remove('ring-4', 'ring-green-400');
                    selectedArabic = btn;
                    selectedArabic.classList.add('ring-4', 'ring-green-400');
                    checkMatch();
                };
                arabicContainer.appendChild(btn);
            });

            function checkMatch() {
                if (selectedIndo && selectedArabic) {
                    if (matchData[selectedIndo.dataset.word] === selectedArabic.dataset.word) {
                        feedbackEl.textContent = 'Benar! (صَحِيحٌ)';
                        feedbackEl.style.color = '#16A34A';
                        selectedIndo.style.visibility = 'hidden';
                        selectedArabic.style.visibility = 'hidden';
                        matchedPairs++;
                        if(matchedPairs === indoWords.length) {
                           feedbackEl.textContent = 'Hebat! Semua terpasang!';
                        }
                    } else {
                        feedbackEl.textContent = 'Kurang tepat!';
                        feedbackEl.style.color = '#DC2626';
                    }
                    setTimeout(() => {
                        if (selectedIndo) selectedIndo.classList.remove('ring-4', 'ring-blue-400');
                        if (selectedArabic) selectedArabic.classList.remove('ring-4', 'ring-green-400');
                        selectedIndo = selectedArabic = null;
                        if(feedbackEl.textContent === 'Kurang tepat!') feedbackEl.textContent = '';
                    }, 1000);
                }
            }
        }
        function setupFindLetterGame(container) { 
             container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-green-800 mb-2">Cari Huruf!</h3>
                <p class="text-center mb-4">Klik pada huruf <span id="target-letter" class="arabic text-3xl font-bold"></span></p>
                <div id="letter-grid" class="grid grid-cols-4 sm:grid-cols-5 gap-3 my-4 max-w-md mx-auto"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6"></p>`;
            
            const grid = container.querySelector('#letter-grid');
            const targetEl = container.querySelector('#target-letter');
            const feedbackEl = container.querySelector('#feedback');

            function nextRound() {
                feedbackEl.textContent = '';
                const targetLetter = findLetterPool[Math.floor(Math.random() * findLetterPool.length)];
                targetEl.textContent = targetLetter;

                let options = [targetLetter];
                while(options.length < 10) {
                    const random = findLetterPool[Math.floor(Math.random() * findLetterPool.length)];
                    if(!options.includes(random)) options.push(random);
                }
                options.sort(() => Math.random() - 0.5);

                grid.innerHTML = '';
                options.forEach(letter => {
                    const btn = document.createElement('button');
                    btn.textContent = letter;
                    btn.className = 'game-button arabic text-4xl p-4 bg-gray-100 rounded-lg hover:bg-gray-200';
                    btn.onclick = () => {
                        if(letter === targetLetter) {
                            feedbackEl.textContent = 'Benar! (أحسنت)';
                            feedbackEl.style.color = '#16A34A';
                            setTimeout(nextRound, 1000);
                        } else {
                            feedbackEl.textContent = 'Salah!';
                            feedbackEl.style.color = '#DC2626';
                        }
                    };
                    grid.appendChild(btn);
                });
            }
            nextRound();
        }
        function setupTrueFalseGame(container, questionIndex = 0) {
            const item = trueFalseData[questionIndex];
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-red-800 mb-4">Benar atau Salah?</h3>
                <div class="bg-gray-100 rounded-lg p-6 text-center">
                    <p class="arabic text-4xl">${item.word}</p>
                    <p class="text-xl mt-2">Artinya: "${item.meaning}"</p>
                </div>
                <div class="flex justify-center gap-4 mt-6">
                    <button id="true-btn" class="game-button w-32 text-lg bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600">Benar</button>
                    <button id="false-btn" class="game-button w-32 text-lg bg-red-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-600">Salah</button>
                </div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;

            const feedbackEl = container.querySelector('#feedback');
            container.querySelector('#true-btn').onclick = () => checkAnswer(true);
            container.querySelector('#false-btn').onclick = () => checkAnswer(false);

            function checkAnswer(userAnswer) {
                if (userAnswer === item.correct) {
                    feedbackEl.textContent = 'Jawabanmu Benar!';
                    feedbackEl.style.color = '#16A34A';
                } else {
                    feedbackEl.textContent = 'Jawabanmu Salah!';
                    feedbackEl.style.color = '#DC2626';
                }
                setTimeout(() => setupTrueFalseGame(container, (questionIndex + 1) % trueFalseData.length), 1500);
            }
        }
        function setupGuessWordGame(container, questionIndex = 0) {
            const item = guessWordData[questionIndex];
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-yellow-800 mb-4">Lengkapi Kalimat!</h3>
                <div class="arabic text-4xl text-center bg-gray-100 p-6 rounded-lg">
                    ${item.sentence.join(' ')}
                </div>
                <div id="options" class="grid grid-cols-3 gap-4 mt-6"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;

            const optionsContainer = container.querySelector('#options');
            const feedbackEl = container.querySelector('#feedback');
            const shuffledOptions = [...item.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = 'game-button arabic text-2xl p-4 bg-yellow-100 rounded-lg hover:bg-yellow-200';
                btn.onclick = () => {
                    if (opt === item.answer) {
                        feedbackEl.textContent = 'Sempurna!';
                        feedbackEl.style.color = '#16A34A';
                    } else {
                        feedbackEl.textContent = 'Bukan yang itu!';
                        feedbackEl.style.color = '#DC2626';
                    }
                    setTimeout(() => setupGuessWordGame(container, (questionIndex + 1) % guessWordData.length), 1500);
                }
                optionsContainer.appendChild(btn);
            });
        }
        function setupGreetingGame(container, questionIndex = 0) {
             const item = greetingGameData[questionIndex];
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-cyan-800 mb-4">Pilih Sapaan Tepat</h3>
                <p class="text-center text-lg mb-4">${item.situation}</p>
                <div id="options" class="flex flex-col gap-3 max-w-md mx-auto"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;

            const optionsContainer = container.querySelector('#options');
            const feedbackEl = container.querySelector('#feedback');
            
            item.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = 'game-button arabic text-2xl p-4 bg-cyan-100 rounded-lg hover:bg-cyan-200';
                btn.onclick = () => {
                    if (opt === item.answer) {
                        feedbackEl.textContent = 'Tepat!';
                        feedbackEl.style.color = '#0e7490';
                    } else {
                        feedbackEl.textContent = 'Kurang sesuai.';
                        feedbackEl.style.color = '#DC2626';
                    }
                    setTimeout(() => setupGreetingGame(container, (questionIndex + 1) % greetingGameData.length), 1500);
                }
                optionsContainer.appendChild(btn);
            });
        }
        function setupLogicalPairsGame(container) {
             container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-orange-800 mb-4">Sambungkan Kalimat</h3>
                <p class="text-center mb-4">Hubungkan pertanyaan di kiri dengan jawaban yang tepat di kanan.</p>
                <div class="flex flex-col md:flex-row justify-between items-start gap-4">
                    <div id="questions" class="w-full md:w-1/2 flex flex-col gap-3"></div>
                    <div id="answers" class="w-full md:w-1/2 flex flex-col gap-3"></div>
                </div>
                <p id="feedback" class="feedback text-center font-bold mt-4 h-6"></p>`;
            
            let selectedQ = null, selectedA = null, matched = 0;
            const feedbackEl = container.querySelector('#feedback');
            const qContainer = container.querySelector('#questions');
            const aContainer = container.querySelector('#answers');

            const questions = Object.keys(logicalPairsData);
            const answers = Object.values(logicalPairsData).sort(() => Math.random() - 0.5);

            questions.forEach(q => {
                const btn = document.createElement('button');
                btn.textContent = q;
                btn.dataset.word = q;
                btn.className = 'game-button arabic w-full p-3 bg-orange-100 rounded-lg text-orange-800 font-semibold';
                btn.onclick = () => {
                    if(selectedQ) selectedQ.classList.remove('ring-4', 'ring-orange-400');
                    selectedQ = btn;
                    selectedQ.classList.add('ring-4', 'ring-orange-400');
                    checkPair();
                };
                qContainer.appendChild(btn);
            });

            answers.forEach(a => {
                const btn = document.createElement('button');
                btn.textContent = a;
                btn.dataset.word = a;
                btn.className = 'game-button arabic w-full p-3 bg-amber-100 rounded-lg text-amber-800 font-semibold';
                 btn.onclick = () => {
                    if(selectedA) selectedA.classList.remove('ring-4', 'ring-amber-400');
                    selectedA = btn;
                    selectedA.classList.add('ring-4', 'ring-amber-400');
                    checkPair();
                };
                aContainer.appendChild(btn);
            });

            function checkPair() {
                if (selectedQ && selectedA) {
                    if (logicalPairsData[selectedQ.dataset.word] === selectedA.dataset.word) {
                        feedbackEl.textContent = 'Pasangan yang tepat!';
                        feedbackEl.style.color = '#9a3412';
                        selectedQ.style.visibility = 'hidden';
                        selectedA.style.visibility = 'hidden';
                        matched++;
                        if (matched === questions.length) feedbackEl.textContent = 'Semua berhasil dipasangkan!';
                    } else {
                        feedbackEl.textContent = 'Bukan pasangan yang cocok!';
                        feedbackEl.style.color = '#DC2626';
                    }
                    setTimeout(() => {
                        if (selectedQ) selectedQ.classList.remove('ring-4', 'ring-orange-400');
                        if (selectedA) selectedA.classList.remove('ring-4', 'ring-amber-400');
                        selectedQ = selectedA = null;
                        if(feedbackEl.textContent === 'Bukan pasangan yang cocok!') feedbackEl.textContent = '';
                    }, 1000);
                }
            }
        }

        // --- GAME 3, 6 (DIREVISI) & 9 (BARU) ---
        function setupArrangeLettersGame(container, wordIndex = 0) { // REVISED
            const item = arrangeWordData[wordIndex];
            const word = item.word;
            const shuffledComponents = [...item.components].sort(() => Math.random() - 0.5);
            
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-purple-800 mb-2">Susun Kata!</h3>
                <p class="text-center mb-4">Seret & lepas komponen untuk membentuk kata yang tersambung.</p>
                <div id="drop-zone" class="drop-zone arabic text-5xl flex justify-center items-center bg-gray-100 p-4 h-28 rounded-lg border-2 border-dashed"></div>
                <div id="letter-source" class="arabic flex justify-center items-center gap-3 mt-4 flex-wrap"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;

            const source = container.querySelector('#letter-source');
            const dropZone = container.querySelector('#drop-zone');
            const feedbackEl = container.querySelector('#feedback');

            shuffledComponents.forEach((comp, index) => {
                const el = document.createElement('div');
                el.textContent = comp;
                el.id = `drag-${index}`;
                el.className = 'draggable text-4xl p-3 bg-purple-200 rounded-lg shadow';
                el.draggable = true;
                el.addEventListener('dragstart', e => e.dataTransfer.setData('text/id', e.target.id));
                source.appendChild(el);
            });
            
            dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('over'); });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('over'));
            dropZone.addEventListener('drop', e => {
                e.preventDefault();
                dropZone.classList.remove('over');
                const id = e.dataTransfer.getData('text/id');
                const draggedEl = source.querySelector(`#${id}`);
                if(draggedEl && draggedEl.style.visibility !== 'hidden') {
                    dropZone.textContent += draggedEl.textContent; // Append text for connection
                    draggedEl.style.visibility = 'hidden';
                    checkAnswer();
                }
            });

            function checkAnswer() {
                const currentAnswer = dropZone.textContent;
                if (source.querySelectorAll('[style="visibility: hidden;"]').length === item.components.length) {
                    if (currentAnswer === word) {
                        feedbackEl.textContent = 'Tepat sekali!';
                        feedbackEl.style.color = '#16A34A';
                        setTimeout(() => setupArrangeLettersGame(container, (wordIndex + 1) % arrangeWordData.length), 1500);
                    } else {
                        feedbackEl.textContent = 'Belum benar, coba lagi!';
                        feedbackEl.style.color = '#DC2626';
                        setTimeout(() => setupArrangeLettersGame(container, wordIndex), 1500);
                    }
                }
            }
        }
        function setupMemoryGame(container) { // REVISED
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-indigo-800 mb-2">Memori Huruf</h3>
                <p id="instruction" class="text-center text-lg mb-4">Hafalkan posisi huruf selama 7 detik!</p>
                <div id="memory-board" class="grid grid-cols-4 gap-4 max-w-md mx-auto"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;

            const board = container.querySelector('#memory-board');
            const feedbackEl = container.querySelector('#feedback');
            const instructionEl = container.querySelector('#instruction');
            const cardsData = [...memoryGameLetters, ...memoryGameLetters].sort(() => 0.7 - Math.random());
            let flippedCards = [];
            let matchedPairs = 0;
            let canClick = false;

            cardsData.forEach(letter => {
                const card = document.createElement('div');
                card.className = 'memory-card h-24';
                card.dataset.letter = letter;
                card.innerHTML = `
                    <div class="memory-card-inner">
                        <div class="memory-card-front"></div>
                        <div class="memory-card-back"><span class="arabic text-4xl text-indigo-800">${letter}</span></div>
                    </div>`;
                card.addEventListener('click', () => handleCardClick(card));
                board.appendChild(card);
            });

            // Preview Phase
            const allCards = board.querySelectorAll('.memory-card');
            allCards.forEach(c => c.classList.add('preview'));
            setTimeout(() => {
                allCards.forEach(c => c.classList.remove('preview'));
                canClick = true;
                instructionEl.textContent = "Cari pasangan huruf yang sama!";
            }, 5000); // 5 detik

            function handleCardClick(card) {
                if (!canClick || flippedCards.length >= 2 || card.classList.contains('flipped')) {
                    return;
                }
                card.classList.add('flipped');
                flippedCards.push(card);
                if (flippedCards.length === 2) {
                    checkMemoryMatch();
                }
            }

            function checkMemoryMatch() {
                const [card1, card2] = flippedCards;
                if (card1.dataset.letter === card2.dataset.letter) {
                    feedbackEl.textContent = 'Cocok!';
                    feedbackEl.style.color = '#4f46e5';
                    matchedPairs++;
                    flippedCards = [];
                    if (matchedPairs === memoryGameLetters.length) {
                        feedbackEl.textContent = 'Semua pasangan ditemukan!';
                    }
                } else {
                    feedbackEl.textContent = 'Coba lagi!';
                    feedbackEl.style.color = '#DC2626';
                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        flippedCards = [];
                        feedbackEl.textContent = '';
                    }, 1200);
                }
            }
        }
        function setupMemoryWordGame(container) { // REVISED & EXPANDED
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-pink-800 mb-2">Memori Kata</h3>
                <p id="instruction" class="text-center text-lg mb-4">Hafalkan pasangan kata selama 7 detik!</p>
                <div id="memory-board" class="grid grid-cols-4 gap-4 max-w-2xl mx-auto"></div>
                <p id="feedback" class="feedback text-center font-semibold h-6 mt-4"></p>`;
            
            const board = container.querySelector('#memory-board');
            const feedbackEl = container.querySelector('#feedback');
            const instructionEl = container.querySelector('#instruction');
            let flippedCards = [];
            let matchedPairs = 0;
            let canClick = false;

            const pairs = memoryWordData; // Use all 8 pairs
            const cardsContent = [];
            pairs.forEach((p, index) => {
              cardsContent.push({ content: p.arabic, pairId: index, type: 'arabic' });
              cardsContent.push({ content: p.indo, pairId: index, type: 'indo' });
            });
            cardsContent.sort(() => 0.7 - Math.random());

            cardsContent.forEach(item => {
                const card = document.createElement('div');
                card.className = 'memory-card h-28 cursor-pointer';
                card.dataset.pairId = item.pairId;
                const isArabic = item.type === 'arabic';
                card.innerHTML = `
                    <div class="memory-card-inner">
                        <div class="memory-card-front"></div>
                        <div class="memory-card-back">
                            <span class="${isArabic ? 'arabic text-2xl' : 'text-lg'} ${isArabic ? 'text-pink-800' : 'text-gray-700'}">${item.content}</span>
                        </div>
                    </div>`;
                card.addEventListener('click', () => handleCardClick(card));
                board.appendChild(card);
            });

            // Preview Phase
            const allCards = board.querySelectorAll('.memory-card');
            allCards.forEach(c => c.classList.add('preview'));
            setTimeout(() => {
                allCards.forEach(c => c.classList.remove('preview'));
                canClick = true;
                instructionEl.textContent = "Cocokkan kata dengan artinya!";
            }, 5000); // 5 detik

            function handleCardClick(card) {
                if (!canClick || flippedCards.length >= 2 || card.classList.contains('flipped')) return;
                card.classList.add('flipped');
                flippedCards.push(card);
                if (flippedCards.length === 2) checkMemoryMatch();
            }

            function checkMemoryMatch() {
                const [card1, card2] = flippedCards;
                if (card1.dataset.pairId === card2.dataset.pairId) {
                    feedbackEl.textContent = 'Cocok!';
                    feedbackEl.style.color = '#be185d';
                    matchedPairs++;
                    flippedCards = [];
                    if (matchedPairs === pairs.length) {
                        feedbackEl.textContent = 'Luar biasa! Semua cocok!';
                    }
                } else {
                    feedbackEl.textContent = 'Bukan pasangannya!';
                    feedbackEl.style.color = '#DC2626';
                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        flippedCards = [];
                        feedbackEl.textContent = '';
                    }, 1200);
                }
            }
        }

        // --- (BARU) GAME 10: TIC TAC TOE LOGIC ---

        function setupTicTacToeGame(container) {
            // 1. Inject HTML untuk papan TTT
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-center text-teal-800 mb-4">Tic Tac Toe Kosa Kata</h3>
                <div class="max-w-xs mx-auto bg-white p-4 rounded-lg shadow-inner">
                    <div id="ttt-status-message" class="text-xl font-semibold text-center text-blue-600 mb-4">
                        Giliran Pemain X
                    </div>
                    <div id="ttt-board" class="grid grid-cols-3 gap-3 bg-gray-200 p-3 rounded-lg shadow-inner">
                        <!-- Sel-sel TTT akan dibuat oleh JS -->
                    </div>
                    <button id="ttt-reset-button" class="w-full mt-6 bg-red-500 text-white py-3 px-6 rounded-lg text-lg font-semibold shadow-md hover:bg-red-600 transition">
                        Ulangi Permainan
                    </button>
                </div>
            `;
            
            // 2. Panggil fungsi inisialisasi TTT
            initTicTacToeGame();
        }

        // (BARU) Fungsi inisialisasi utama untuk Tic Tac Toe
        function initTicTacToeGame() {
            // Cache DOM elements
            tttGameLogic.dom.boardElement = document.getElementById('ttt-board');
            tttGameLogic.dom.statusMessage = document.getElementById('ttt-status-message');
            tttGameLogic.dom.resetButton = document.getElementById('ttt-reset-button');
            
            // Modal elements (sudah ada di HTML utama)
            tttGameLogic.dom.questionModal = document.getElementById('ttt-question-modal');
            tttGameLogic.dom.questionBox = document.getElementById('ttt-question-box');
            tttGameLogic.dom.vocabWordElement = document.getElementById('ttt-vocab-word');
            tttGameLogic.dom.optionsContainer = document.getElementById('ttt-options-container');
            tttGameLogic.dom.resultMessage = document.getElementById('ttt-result-message');
            tttGameLogic.dom.timerDisplay = document.getElementById('ttt-timer-display');

            // Reset state
            tttGameLogic.player = 'X';
            tttGameLogic.board = Array(9).fill('');
            tttGameLogic.active = true;
            tttGameLogic.targetIndex = null;
            if (tttGameLogic.timer) clearInterval(tttGameLogic.timer);
            
            // Setup UI
            tttGameLogic.dom.statusMessage.textContent = `Giliran Pemain ${tttGameLogic.player}`;
            tttGameLogic.dom.resultMessage.textContent = '';
            tttGameLogic.dom.timerDisplay.textContent = '';
            tttGameLogic.dom.boardElement.innerHTML = '';

            if (tttGameLogic.questions.length === 0) {
                tttGameLogic.questions = [...ticTacToeData].sort(() => 0.5 - Math.random());
            }

            // Buat sel papan
            tttGameLogic.board.forEach((_, index) => {
                const cell = document.createElement('div');
                // Gunakan class .ttt-cell
                cell.className = 'ttt-cell w-full h-20 md:h-24 bg-white rounded-lg flex items-center justify-center text-5xl md:text-6xl font-bold cursor-pointer transition duration-300 hover:bg-gray-50';
                cell.dataset.index = index;
                cell.addEventListener('click', handleTicTacToeCellClick);
                tttGameLogic.dom.boardElement.appendChild(cell);
            });

            // Add reset listener
            // (Clone untuk hapus listener lama jika ada)
            const oldResetButton = tttGameLogic.dom.resetButton;
            const newResetButton = oldResetButton.cloneNode(true);
            oldResetButton.parentNode.replaceChild(newResetButton, oldResetButton);
            newResetButton.addEventListener('click', initTicTacToeGame);
            tttGameLogic.dom.resetButton = newResetButton; // Update cache
            
            // Pastikan modal tersembunyi
            hideTicTacToeQuestionModal();
        }

        const tttWinPatterns = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        function handleTicTacToeCellClick(event) {
            const clickedCellIndex = parseInt(event.target.dataset.index);
            if (tttGameLogic.board[clickedCellIndex] !== '' || !tttGameLogic.active) {
                return;
            }
            tttGameLogic.targetIndex = clickedCellIndex;
            showTicTacToeQuestion();
        }

        function showTicTacToeQuestion() {
            if (tttGameLogic.questions.length === 0) {
                tttGameLogic.questions = [...ticTacToeData].sort(() => 0.5 - Math.random());
            }
            const currentQuestion = tttGameLogic.questions.pop();
            
            const dom = tttGameLogic.dom;
            dom.questionModal.dataset.correctIndex = currentQuestion.correct;
            dom.vocabWordElement.textContent = currentQuestion.word;
            dom.optionsContainer.innerHTML = '';

            currentQuestion.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'game-button w-full p-3 rounded-lg text-lg font-medium text-white bg-blue-500 hover:bg-blue-600 transition duration-200';
                optionButton.textContent = option;
                optionButton.dataset.index = index;
                optionButton.addEventListener('click', handleTicTacToeOptionClick);
                dom.optionsContainer.appendChild(optionButton);
            });

            if (tttGameLogic.timer) clearInterval(tttGameLogic.timer);
            let timeLeft = 8;
            dom.timerDisplay.textContent = timeLeft;
            dom.timerDisplay.classList.remove('text-gray-500');
            dom.timerDisplay.classList.add('text-red-500');

            tttGameLogic.timer = setInterval(() => {
                timeLeft--;
                dom.timerDisplay.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(tttGameLogic.timer);
                    handleTicTacToeTimeout();
                }
            }, 1000);

            dom.questionModal.style.display = 'flex';
        }

        function hideTicTacToeQuestionModal() {
            if (tttGameLogic.timer) clearInterval(tttGameLogic.timer);
            const dom = tttGameLogic.dom;
            // Cek jika dom.timerDisplay ada sebelum mengubah
            if(dom.timerDisplay) dom.timerDisplay.textContent = '';
            if(dom.questionModal) dom.questionModal.style.display = 'none';
            if(dom.resultMessage) dom.resultMessage.textContent = '';
        }

        function handleTicTacToeOptionClick(event) {
            clearInterval(tttGameLogic.timer);
            const dom = tttGameLogic.dom;
            dom.timerDisplay.classList.add('text-gray-500');
            
            const selectedIndex = parseInt(event.target.dataset.index);
            const correctIndex = parseInt(dom.questionModal.dataset.correctIndex);

            if (selectedIndex === correctIndex) {
                dom.resultMessage.textContent = 'Benar! (Correct!)';
                dom.resultMessage.style.color = '#16A34A';
                setTimeout(() => {
                    placeTicTacToeMark(tttGameLogic.targetIndex);
                    hideTicTacToeQuestionModal();
                }, 800);
            } else {
                dom.resultMessage.textContent = 'Salah! (Incorrect!) Giliran lawan.';
                dom.resultMessage.style.color = '#DC2626';
                setTimeout(() => {
                    changeTicTacToePlayer();
                    hideTicTacToeQuestionModal();
                }, 1200);
            }
        }

        function handleTicTacToeTimeout() {
            const dom = tttGameLogic.dom;
            dom.resultMessage.textContent = 'Waktu Habis! Giliran lawan.';
            dom.resultMessage.style.color = '#DC2626';
            setTimeout(() => {
                changeTicTacToePlayer();
                hideTicTacToeQuestionModal();
            }, 1200);
        }

        function placeTicTacToeMark(cellIndex) {
            if (!tttGameLogic.active || tttGameLogic.board[cellIndex] !== '') return;

            const dom = tttGameLogic.dom;
            tttGameLogic.board[cellIndex] = tttGameLogic.player;
            const cellElement = dom.boardElement.children[cellIndex];
            cellElement.textContent = tttGameLogic.player;
            cellElement.classList.add('filled');
            cellElement.classList.add(tttGameLogic.player === 'X' ? 'text-blue-600' : 'text-pink-500');

            if (checkTicTacToeWin()) {
                endTicTacToeGame(false);
            } else if (checkTicTacToeDraw()) {
                endTicTacToeGame(true);
            } else {
                changeTicTacToePlayer();
            }
        }

        function changeTicTacToePlayer() {
            tttGameLogic.player = tttGameLogic.player === 'X' ? 'O' : 'X';
            tttGameLogic.dom.statusMessage.textContent = `Giliran Pemain ${tttGameLogic.player}`;
        }

        function checkTicTacToeWin() {
            return tttWinPatterns.some(pattern => {
                return pattern.every(index => tttGameLogic.board[index] === tttGameLogic.player);
            });
        }

        function checkTicTacToeDraw() {
            return tttGameLogic.board.every(cell => cell !== '');
        }

        function endTicTacToeGame(isDraw) {
            tttGameLogic.active = false;
            const dom = tttGameLogic.dom;
            if (isDraw) {
                dom.statusMessage.textContent = 'Permainan Seri!';
                dom.statusMessage.classList.add('text-gray-700');
            } else {
                dom.statusMessage.textContent = `Pemain ${tttGameLogic.player} Menang!`;
                dom.statusMessage.classList.add('text-green-600');
            }
        }
        // --- AKHIR GAME 10 ---

    </script>
</body>
</html>
